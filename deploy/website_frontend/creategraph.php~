<?php

require_once( "sparqllib.php" );

$db = sparql_connect( "http://192.168.0.181:3030/d2rq/query" );
if( !$db ) { print $db->errno() . ": " . $db->error(). "\n"; exit; }
$db->ns( "foaf","http://xmlns.com/foaf/0.1/" );
$db->ns( "dc","http://purl.org/dc/elements/1.1/" );
$db->ns( "ms","http://measurementg/dc/elements/1.1/" );

$sparql = 'PREFIX dc: <http://purl.org/dc/elements/1.0/>  
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
select ?time ?value where
{
?a <uri:sensor:measurevalue>  ?value.
?a <uri:sensor:measuretimestamp>  ?time.
?a <uri:sensor:measuresensorid>    ?id.
FILTER ( ?id=1  && ?time > \''.$_GET['timefrom'].'\'^^xsd:dateTime && ?time < \''.$_GET['timeto'].'\'^^xsd:dateTime ) 
}';


//echo $sparql;
 
$result = $db->query( $sparql ); 

if( !$result ) { print $db->errno() . ":" . $db->error(). "\n"; exit; }
 
$fields = $result->field_array( $result );

//if ($_GET['key']=="")

//$jsontree='[{"title":"Selection"}';
$jsontree='{"data":[';
while( $row = $result->fetch_array() )
{
	
	//foreach( $fields as $field )
	//{
		$jsontree="$jsontree".'['."\"$row[time]\",".substr($row[value], 0, -2).'],';
	//}
	
}

$jsontree=substr($jsontree, 0, -1);
$jsontree="$jsontree".'],"labels":["labelA"]}';
//echo "$jsontree";


echo "$jsontree";




